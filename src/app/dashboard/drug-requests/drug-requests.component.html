<div class="drug-requests-container slide-in">
    <div class="page-header">
        <h1>Liste des demandes de drogue</h1>
        <button class="btn-primary add-btn" routerLink="/dashboard/drug-requests-form">
            <span class="add-icon">+</span> Ajouter une demande
        </button>
    </div>

    <div class="filters">
        <div class="search-container">
            <input
                    type="text"
                    placeholder="Rechercher..."
                    class="search-input"
                    (input)="onSearch($event)"
            >
        </div>

        <div class="date-filter">
            <input
                    type="date"
                    [ngModel]="dateFilter | date:'yyyy-MM-dd'"
                    (ngModelChange)="onDateFilterChange($event)"
                    class="form-control"
                    placeholder="Filtrer par date">
        </div>

        <div class="governorat-filter">
            <select
                    [(ngModel)]="governoratFilter"
                    (ngModelChange)="applyFilters()"
                    class="form-control">
                <option value="">Tous les gouvernorats</option>
                <option *ngFor="let gov of gouvernorats" [value]="gov">{{ gov }}</option>
            </select>
        </div>

        <div class="structure-filter">
            <select
                    [(ngModel)]="structureFilter"
                    (ngModelChange)="applyFilters()"
                    class="form-control">
                <option value="">Toutes les structures</option>
                <option *ngFor="let struct of structures" [value]="struct">{{ struct }}</option>
            </select>
        </div>

        <div class="status-filters">
            <button
                    class="filter-btn"
                    [class.active]="activeFilter === 'all'"
                    (click)="filterByStatus('all')"
            >
                Toutes
            </button>
            <button
                    class="filter-btn"
                    [class.active]="activeFilter === 'pending'"
                    (click)="filterByStatus('pending')"
            >
                En attente
            </button>
            <button
                    class="filter-btn"
                    [class.active]="activeFilter === 'approved'"
                    (click)="filterByStatus('approved')"
            >
                Approuv√©es
            </button>
            <button
                    class="filter-btn"
                    [class.active]="activeFilter === 'rejected'"
                    (click)="filterByStatus('rejected')"
            >
                Rejet√©es
            </button>
        </div>
    </div>

    <div class="table-container" *ngIf="filteredForms.length > 0; else noData">
        <table class="requests-table">
            <thead>
            <tr>
                <th (click)="sortTable('code')">
                    Code
                    <span class="sort-icon" *ngIf="sortField === 'code'">
                        {{ sortDirection === 'asc' ? '‚Üë' : '‚Üì' }}
                    </span>
                </th>
                <th (click)="sortTable('dateAjout')">
                    Date d'ajout
                    <span class="sort-icon" *ngIf="sortField === 'dateAjout'">
                        {{ sortDirection === 'asc' ? '‚Üë' : '‚Üì' }}
                    </span>
                </th>
                <th (click)="sortTable('governorat')">
                    Gouvernorat
                    <span class="sort-icon" *ngIf="sortField === 'governorat'">
                        {{ sortDirection === 'asc' ? '‚Üë' : '‚Üì' }}
                    </span>
                </th>
                <th (click)="sortTable('structure')">
                    Structure
                    <span class="sort-icon" *ngIf="sortField === 'structure'">
                        {{ sortDirection === 'asc' ? '‚Üë' : '‚Üì' }}
                    </span>
                </th>
                <th (click)="sortTable('status')">
                    Statut
                    <span class="sort-icon" *ngIf="sortField === 'status'">
                        {{ sortDirection === 'asc' ? '‚Üë' : '‚Üì' }}
                    </span>
                </th>
                <th>Actions</th>
            </tr>
            </thead>
            <tbody>
            <tr *ngFor="let form of filteredForms">
                <td>{{ form.code }}</td>
                <td>{{ form.dateAjout | date:'dd/MM/yyyy HH:mm' }}</td>
                <td>{{ form.governorat }}</td>
                <td>{{ form.structure }}</td>
                <td>
                    <span class="status-badge" [class]="form.status">
                        {{ getStatusLabel(form.status) }}
                    </span>
                </td>
                <td>
                    <div class="action-buttons">
                        <button class="action-btn view-btn" title="Voir">üëÅÔ∏è</button>
                        <button class="action-btn edit-btn" title="Modifier" (click)="editForm(form.id)">‚úèÔ∏è</button>
                        <button class="action-btn delete-btn" title="Supprimer">üóëÔ∏è</button>
                    </div>
                </td>
            </tr>
            </tbody>
        </table>
    </div>

    <ng-template #noData>
        <div class="no-data">
            <p>Aucune demande trouv√©e</p>
        </div>
    </ng-template>
</div>
